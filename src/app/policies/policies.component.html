<!-- HEADER -->
<div class="header">
  <h1>Policy Management</h1>
  <div class="header-actions">
    <!-- Add Sub Category Button -->
    <button class="btn-create secondary" (click)="openSubCategoryModal()">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd"
          d="M2 5a2 2 0 012-2h12a2 2 0 012 2v2a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm14 1a1 1 0 11-2 0 1 1 0 012 0zM2 13a2 2 0 012-2h12a2 2 0 012 2v2a2 2 0 01-2 2H4a2 2 0 01-2-2v-2zm14 1a1 1 0 11-2 0 1 1 0 012 0z"
          clip-rule="evenodd" />
      </svg>
      Add Sub Category
    </button>

    <!-- Create Policy Button -->
    <button class="btn-create" (click)="openCreatePolicyModal()">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" />
      </svg>
      New Policy
    </button>
  </div>
</div>

<!-- KPI GRID -->
<div class="kpi-grid">
  <!-- Merged Policy Stats Card -->
  <div class="kpi-card">
    <div class="combined-stats-card">
      <div class="stat-group">
        <div class="label">Total Policies</div>
        <h3>{{ totalPolicies }}</h3>
        <div class="trend up">Overall</div>
      </div>
      <div class="stat-group">
        <div class="label">Active Policies</div>
        <h3>{{ activePolicies }}</h3>
        <div class="trend up">Currently Active</div>
      </div>
    </div>
  </div>

  <!-- Renewal Requests Card -->
  <div class="kpi-card">
    <div class="card-header-row">
      <div class="label">Renewal Requests</div>
      <button class="btn-icon-small" (click)="openRenewalsModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="16" height="16">
          <path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z" />
        </svg>
      </button>
    </div>
    <h3>50</h3> <!-- Dummy total for renewals -->
    <div class="trend down">Needs Attention</div>
  </div>
  <div class="kpi-card">
    <div class="card-header-row">
      <div class="label">Policies Sub Categories</div>
      <button class="btn-icon-small" (click)="openSubCategoryListModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="16" height="16">
          <path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z" />
        </svg>
      </button>
    </div>
    <h3>{{ (subCategories$ | async)?.length || 0 }}</h3>
    <div class="trend">Manage Categories</div>
  </div>
</div>

<!-- POLICY TABLE ACCORDION -->
<div class="table-card" style="margin-bottom: 24px;">
  <!-- Header -->
  <div class="table-card-header" (click)="togglePoliciesAccordion()">
    <div class="table-title">
      <h3>All Policies</h3>
      <input type="text" [formControl]="searchControl" placeholder="Search policies..."
        (click)="$event.stopPropagation()"
        style="width: 200px; padding: 6px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-size: 13px;">
    </div>
    <div class="accordion-icon" [class.expanded]="isPoliciesExpanded">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20">
        <path fill-rule="evenodd"
          d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
          clip-rule="evenodd" />
      </svg>
    </div>
  </div>

  <!-- Body -->
  <div class="table-body" [class.expanded]="isPoliciesExpanded">
    <table class="policy-table">
      <thead>
        <tr>
          <th>Policy Name</th>
          <th>Sub Category</th>
          <th>Packages</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="isLoading">
          <td colspan="5">
            <div class="loading-spinner-container">
              <div class="loading-spinner"></div>
            </div>
          </td>
        </tr>
        <tr *ngFor="let policy of filteredPolicies$ | async">
          <td>{{ policy.policyName }}</td>
          <td>{{ policy.subCategoryName || 'N/A' }}</td>
          <td style="font-size: 11px; color: #666; max-width: 250px;">
            <span *ngFor="let pkg of policy.packages; let isLast=last">{{ pkg.name }}<span *ngIf="!isLast">,
              </span></span>
            <span *ngIf="!policy.packages?.length">-</span>
          </td>
          <td><span class="badge" [ngClass]="policy.status?.toLowerCase()">{{ policy.status }}</span></td>
          <td>
            <button class="btn-secondary" style="padding: 4px 8px; font-size: 12px;"
              (click)="openEditPolicyModal(policy)">Edit</button>
            <button class="btn-icon delete" (click)="onDeletePolicy(policy)" title="Delete Policy"
              style="color: #ef4444; margin-left: 8px;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="16" height="16">
                <path fill-rule="evenodd"
                  d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                  clip-rule="evenodd" />
              </svg>
            </button>
          </td>
        </tr>
        <tr *ngIf="!isLoading && (filteredPolicies$ | async)?.length === 0">
          <td colspan="5" style="text-align: center; padding: 24px; color: #86868b;">No policies found.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- CLAIMS TABLE ACCORDION -->
<div class="table-card">
  <!-- Header -->
  <div class="table-card-header" (click)="toggleClaimsAccordion()">
    <div class="table-title">
      <h3>Recent Claims</h3>
      <input type="text" [formControl]="dashboardClaimsSearchControl" placeholder="Search claims..."
        (click)="$event.stopPropagation()"
        style="width: 200px; padding: 6px 12px; border: 1px solid #d2d2d7; border-radius: 6px; font-size: 13px;">
    </div>
    <div class="accordion-icon" [class.expanded]="isClaimsExpanded">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20">
        <path fill-rule="evenodd"
          d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
          clip-rule="evenodd" />
      </svg>
    </div>
  </div>

  <!-- Body -->
  <div class="table-body" [class.expanded]="isClaimsExpanded">
    <table class="policy-table">
      <thead>
        <tr>
          <th>Claim ID</th>
          <th>Policy</th>
          <th>Claimant</th>
          <th>Date</th>
          <th>Amount</th>
          <th>Status</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <!-- Loading -->
        <tr *ngIf="dashboardClaimsIsLoading">
          <td colspan="7">
            <div class="loading-spinner-container">
              <div class="loading-spinner"></div>
            </div>
          </td>
        </tr>

        <!-- Data -->
        <tr *ngFor="let claim of paginatedDashboardClaims">
          <td>{{ claim.id }}</td>
          <td>{{ claim.policyName }}</td>
          <td>{{ claim.claimant }}</td>
          <td>{{ claim.dateSubmitted | date:'shortDate' }}</td>
          <td>{{ claim.amount | currency }}</td>
          <td>
            <span class="badge" [ngClass]="{
              'active': claim.status === 'Approved', 
              'pending': claim.status === 'Pending',
              'expired': claim.status === 'Rejected'
            }">
              {{ claim.status }}
            </span>
          </td>
          <td style="text-align: right;">
            <button class="btn-secondary small">Details</button>
          </td>
        </tr>

        <!-- Empty -->
        <tr *ngIf="!dashboardClaimsIsLoading && dashboardClaimsList.length === 0">
          <td colspan="7" style="text-align: center; padding: 24px; color: #86868b;">
            Click to load claims...
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination-controls" *ngIf="!dashboardClaimsIsLoading && dashboardClaimsList.length > 0"
      style="padding-bottom: 16px;">
      <button class="btn-secondary small" (click)="prevDashboardClaimsPage()"
        [disabled]="dashboardClaimsPage === 1">Previous</button>
      <span>Page {{ dashboardClaimsPage }} of {{ totalDashboardClaimsPages }}</span>
      <button class="btn-secondary small" (click)="nextDashboardClaimsPage()"
        [disabled]="dashboardClaimsPage === totalDashboardClaimsPages">Next</button>
    </div>
  </div>
</div>

<!-- CREATE SUB CATEGORY MODAL -->
<div class="modal-overlay" *ngIf="isSubCategoryModalOpen">
  <div class="modal-card">
    <div class="modal-header">
      <h2>Add Sub Category</h2>
      <button class="btn-close" (click)="closeSubCategoryModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20">
          <path
            d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
        </svg>
      </button>
    </div>
    <form [formGroup]="subCategoryForm" (ngSubmit)="onCreateSubCategory()">
      <div class="modal-body">
        <div class="field">
          <label>Sub Category Name</label>
          <input type="text" formControlName="name" placeholder="e.g. Private Car, Commercial Truck" />
        </div>
        <div class="field">
          <label>Description</label>
          <textarea formControlName="description" placeholder="Brief description of this sub-category"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-secondary" (click)="closeSubCategoryModal()">Cancel</button>
        <button type="submit" class="btn-primary" [disabled]="subCategoryForm.invalid || isSubmitting">
          {{ isSubmitting ? 'Creating...' : 'Create Sub Category' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- EDIT POLICY MODAL -->
<div class="modal-overlay" *ngIf="isEditPolicyModalOpen && selectedPolicy">
  <div class="modal-card">
    <div class="modal-header">
      <h2>Edit Policy</h2>
      <button class="btn-close" (click)="closeEditPolicyModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20">
          <path
            d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="field">
        <label>Policy Name</label>
        <input type="text" [value]="selectedPolicy.policyName" disabled style="background: #f5f5f7; color: #666;" />
      </div>
      <div class="field">
        <label>Sub Category</label>
        <input type="text" [value]="selectedPolicy.subCategoryName" disabled
          style="background: #f5f5f7; color: #666;" />
      </div>

      <div class="field">
        <label>Packages</label>
        <div style="background: #f5f5f7; padding: 12px; border-radius: 8px; color: #666; font-size: 13px;">
          <div *ngFor="let pkg of selectedPolicy.packages" style="margin-bottom: 8px;">
            <strong>{{ pkg.name }}</strong>: {{ pkg.coverages?.join(', ') }}
          </div>
        </div>
      </div>

      <div class="field">
        <label>Status</label>
        <select [formControl]="editStatusControl">
          <option value="active">Active</option>
          <option value="terminated">Terminated</option>
        </select>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn-secondary" (click)="closeEditPolicyModal()">Cancel</button>
      <button type="button" class="btn-primary" (click)="onUpdatePolicyStatus()">Update Status</button>
    </div>
  </div>
</div>

<!-- LIST SUB CATEGORIES MODAL -->
<div class="modal-overlay" *ngIf="isSubCategoryListModalOpen">
  <div class="modal-card">
    <div class="modal-header">
      <h2>Sub Categories</h2>
      <button class="btn-close" (click)="closeSubCategoryListModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20">
          <path
            d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <table class="policy-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Status</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let sub of subCategories$ | async">
            <td>{{ sub.name }}</td>
            <td>{{ sub.description || '-' }}</td>
            <td><span class="badge active">Active</span></td>
            <td style="text-align: right;">
              <button class="btn-icon delete" (click)="onDeleteSubCategory(sub.id)" title="Delete Category"
                style="color: #ef4444;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="16" height="16">
                  <path fill-rule="evenodd"
                    d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                    clip-rule="evenodd" />
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- CREATE POLICY MODAL -->
<div class="modal-overlay" *ngIf="isCreatePolicyModalOpen">
  <div class="modal-card">
    <div class="modal-header">
      <h2>Create New Policy</h2>
      <button class="btn-close" (click)="closeCreatePolicyModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20">
          <path
            d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
        </svg>
      </button>
    </div>
    <form class="modal-form-content" [formGroup]="createPolicyForm" (ngSubmit)="onCreatePolicy()">
      <div class="modal-body">
        <!-- Plain numeric text inputs (no helpers) -->
        <div class="field">
          <label>Category (Sub Category)</label>
          <select formControlName="subCategory">
            <option value="" disabled>Select a category</option>
            <option *ngFor="let sub of subCategories$ | async" [value]="sub.id">{{ sub.name }}</option>
          </select>
        </div>
        <div class="form-row">
          <div class="field">
            <label>Policy Name</label>
            <input type="text" formControlName="policyName" placeholder="e.g. Motor Comprehensive" />
          </div>
          <div class="field">
            <label>Policy Type</label>
            <select formControlName="policyType">
              <option value="standard">Standard</option>
              <option value="renewal">Renewal</option>
            </select>
          </div>
          <div class="field">
            <label>Tenure (Duration)</label>
            <input type="text" formControlName="tenure" placeholder="e.g. 12 Months" />
          </div>
        </div>

        <!-- Additional Policy Details -->
        <div class="form-row" style="margin-top: 16px;">
          <div class="field">
            <label>Policy Expiry Date</label>
            <input type="date" formControlName="expiryDate" />
          </div>
          <div class="field">
            <label>Payment Frequency</label>
            <select formControlName="paymentFrequency">
              <option value="Monthly">Monthly Installments</option>
              <option value="Upfront">Upfront Payment</option>
            </select>
          </div>
        </div>

        <!-- Policy Document Upload -->
        <div class="field" style="margin-top: 16px;">
          <label>Policy Document (Scan/Upload)</label>
          <div class="file-upload-container" style="display: flex; gap: 12px; align-items: center;">
            <input type="file" (change)="onFileChange($event)" accept="image/*,application/pdf" style="display: none" #fileInput>
            
            <button type="button" class="btn-secondary" (click)="fileInput.click()">
              Upload File
            </button>
            
            <button type="button" class="btn-secondary" (click)="openCamera()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="16" height="16" style="margin-right: 4px;">
                <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
              </svg>
              Take Photo
            </button>

            <div *ngIf="createPolicyForm.get('policyDocument')?.value" style="font-size: 13px; color: #166534; display: flex; align-items: center; gap: 4px;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="16" height="16">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
              Document Attached: {{ createPolicyForm.get('policyDocument')?.value.name }}
            </div>
          </div>
        </div>

        <!-- Dynamic Packages Section -->
        <div class="packages-section">
          <div class="section-header">
            <h3>Packages</h3>
            <button type="button" class="btn-secondary small" (click)="addPackage()">+ Add Package</button>
          </div>

          <div formArrayName="packages">
            <div *ngFor="let pkg of packages.controls; let i=index" [formGroupName]="i" class="package-card">
              <div class="package-header">
                <span>Package {{ i + 1 }}</span>
                <button type="button" class="btn-icon delete" (click)="removePackage(i)"
                  *ngIf="packages.length > 1">×</button>
              </div>

              <div class="field">
                <label>Package Name</label>
                <input type="text" formControlName="name" placeholder="e.g. Gold, Silver" />
              </div>

              <div class="package-details-grid">
                <!-- Coverages Column -->
                <div class="detail-column">
                  <div class="column-header">
                    <label>Coverages</label>
                    <button type="button" class="btn-link-small" (click)="addCoverage(i)">+ Add</button>
                  </div>
                  <div class="detail-list" formArrayName="coverages">
                    <div *ngFor="let cov of getPackageCoverages(i).controls; let j=index" [formGroupName]="j"
                      class="detail-row">
                      <input type="text" formControlName="name" placeholder="Coverage Name" class="input-sm"
                        style="flex: 2;">
                      <div class="input-suffix-group" style="flex: 1; min-width:0; display:flex; align-items:center; gap:8px;">
                        <!-- % placed outside input to avoid overlap -->
                        <input type="text" formControlName="percentage" placeholder="100" class="input-sm">
                        <span class="suffix-out">%</span>
                      </div>
                      <button type="button" class="btn-icon-remove" (click)="removeCoverage(i, j)">×</button>
                    </div>
                    <div *ngIf="getPackageCoverages(i).length === 0" class="empty-text">No coverages added</div>
                  </div>
                </div>

                <!-- Flat Fees Column -->
                <div class="detail-column">
                  <div class="column-header">
                    <label>Flat Fees</label>
                    <button type="button" class="btn-link-small" (click)="addFee(i)">+ Add</button>
                  </div>
                  <div class="detail-list" formArrayName="flatFees">
                    <div *ngFor="let fee of getPackageFees(i).controls; let k=index" [formGroupName]="k"
                      class="detail-row">
                      <input type="text" formControlName="name" placeholder="Fee Name" class="input-sm"
                        style="flex: 2;">
                      <div class="input-suffix-group" style="flex: 1; min-width:0; display:flex; align-items:center; gap:8px;">
                        <!-- $ placed outside input to avoid overlap -->
                        <span class="prefix-out">$</span>
                        <input type="text" formControlName="amount" placeholder="0.00" class="input-sm">
                      </div>
                      <button type="button" class="btn-icon-remove" (click)="removeFee(i, k)">×</button>
                    </div>
                    <div *ngIf="getPackageFees(i).length === 0" class="empty-text">No fees added</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-secondary" (click)="closeCreatePolicyModal()">Cancel</button>
        <!-- allow submit button to be clickable so we can show validation toasts; actual submission is guarded in TS -->
        <button type="submit" class="btn-primary" [disabled]="isSubmitting">
          {{ isSubmitting ? 'Creating...' : 'Create Policy' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- CLAIMS MODAL -->
<div class="modal-overlay" *ngIf="isClaimsModalOpen">
  <div class="modal-card full-screen-modal">
    <div class="modal-header">
      <h2>Claims Management</h2>
      <button class="btn-close" (click)="closeClaimsModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20">
          <path
            d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <!-- Loading State -->
      <div class="loading-spinner-container" *ngIf="isLoadingClaims">
        <div class="loading-spinner"></div>
      </div>

      <!-- Claims Table -->
      <table class="policy-table" *ngIf="!isLoadingClaims">
        <thead>
          <tr>
            <th>Claim ID</th>
            <th>Policy</th>
            <th>Claimant</th>
            <th>Date Submitted</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let claim of paginatedClaims">
            <td>{{ claim.id }}</td>
            <td>{{ claim.policyName }}</td>
            <td>{{ claim.claimant }}</td>
            <td>{{ claim.dateSubmitted | date:'mediumDate' }}</td>
            <td>{{ claim.amount | currency }}</td>
            <td>
              <span class="badge" [ngClass]="{
                'active': claim.status === 'Approved', 
                'pending': claim.status === 'Pending' || claim.status === 'In Review',
                'expired': claim.status === 'Rejected'
              }">
                {{ claim.status }}
              </span>
            </td>
            <td>
              <button class="btn-secondary small">View</button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination-controls" *ngIf="!isLoadingClaims && claimsList.length > 0">
        <button class="btn-secondary small" (click)="prevClaimsPage()" [disabled]="claimsPage === 1">Previous</button>
        <span>Page {{ claimsPage }} of {{ totalClaimsPages }}</span>
        <button class="btn-secondary small" (click)="nextClaimsPage()"
          [disabled]="claimsPage === totalClaimsPages">Next</button>
      </div>
    </div>
  </div>
</div>

<!-- CAMERA MODAL -->
<div class="modal-overlay" *ngIf="cameraModalOpen" style="z-index: 2000;">
  <div class="modal-card" style="max-width: 600px;">
    <div class="modal-header">
      <h2>Capture Document</h2>
      <button class="btn-close" (click)="cameraModalOpen = false; stopCamera()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20">
          <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
        </svg>
      </button>
    </div>
    <div class="modal-body" style="display: flex; flex-direction: column; align-items: center; gap: 16px;">
      <div class="camera-viewport" style="width: 100%; background: #000; border-radius: 8px; overflow: hidden; position: relative; aspect-ratio: 4/3;">
        <video id="policyCameraModalVideo" [style.display]="tempImagePreview ? 'none' : 'block'" style="width: 100%; height: 100%; object-fit: cover;" autoplay playsinline></video>
        <img *ngIf="tempImagePreview" [src]="tempImagePreview" style="width: 100%; height: 100%; object-fit: contain;" />
      </div>
      
      <div class="camera-controls" style="display: flex; gap: 16px;">
        <button *ngIf="!tempImagePreview" class="btn-primary" (click)="takePhoto()">Capture</button>
        
        <ng-container *ngIf="tempImagePreview">
          <button class="btn-secondary" (click)="retake()">Retake</button>
          <button class="btn-primary" (click)="savePhoto()">Use Photo</button>
        </ng-container>
      </div>
    </div>
  </div>
</div>

<!-- RENEWALS MODAL -->
<div class="modal-overlay" *ngIf="isRenewalsModalOpen">
  <div class="modal-card full-screen-modal">
    <div class="modal-header">
      <h2>Renewal Requests</h2>
      <button class="btn-close" (click)="closeRenewalsModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20">
          <path
            d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <!-- Filter Panel -->
      <div class="filter-panel" *ngIf="!isLoadingRenewals">
        <div class="search-wrapper">
          <input type="text" [formControl]="renewalSearchControl" placeholder="Search renewals..."
            style="width: 100%; padding: 8px 12px; border: 1px solid #d2d2d7; border-radius: 8px;">
        </div>
        <div class="toggle-filters">
          <button [class.active]="renewalFilterType === 'insurance'" (click)="setRenewalFilter('insurance')">
            Insurance Policy
          </button>
          <button [class.active]="renewalFilterType === 'radio'" (click)="setRenewalFilter('radio')">
            Radio Licenses
          </button>
        </div>
      </div>

      <!-- Loading State -->
      <div class="loading-spinner-container" *ngIf="isLoadingRenewals">
        <div class="loading-spinner"></div>
      </div>

      <!-- Renewals Table -->
      <table class="policy-table" *ngIf="!isLoadingRenewals">
        <thead>
          <tr>
            <th>Renewal ID</th>
            <th>Entity Name</th>
            <th>Type</th>
            <th>Expiry Date</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of paginatedRenewals">
            <td>{{ item.id }}</td>
            <td>
              <div>{{ item.entityName }}</div>
              <div style="font-size: 11px; color: #86868b;">{{ item.description }}</div>
            </td>
            <td>
              <span class="badge" style="background: #e0f2fe; color: #0284c7;">
                {{ item.type === 'insurance' ? 'Policy' : 'Radio' }}
              </span>
            </td>
            <td>{{ item.expiryDate | date:'mediumDate' }}</td>
            <td>{{ item.amount | currency }}</td>
            <td>
              <span class="badge" [ngClass]="{
                'expired': item.status === 'Overdue',
                'pending': item.status === 'Pending Payment',
                'active': item.status === 'Due Soon'
              }">
                {{ item.status }}
              </span>
            </td>
            <td>
              <button class="btn-secondary small">Review</button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination-controls" *ngIf="!isLoadingRenewals && filteredRenewals.length > 0">
        <button class="btn-secondary small" (click)="prevRenewalPage()" [disabled]="renewalPage === 1">Previous</button>
        <span>Page {{ renewalPage }} of {{ totalRenewalPages }}</span>
        <button class="btn-secondary small" (click)="nextRenewalPage()"
          [disabled]="renewalPage === totalRenewalPages">Next</button>
      </div>
    </div>
  </div>
</div>