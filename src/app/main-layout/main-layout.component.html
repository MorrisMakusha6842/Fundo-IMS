<div class="top-nav">
	<div class="top-nav-inner">
		<div class="left">
			<button class="side-toggle" (click)="toggleSideNav()" [class.rotated]="sideNavCollapsed" aria-label="Toggle sidebar">
			  <!-- toggle svg -->
			  <svg class="toggle-icon" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg" fill="none"><g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(3 3)"><path d="m.5 12.5v-10c0-1.1045695.8954305-2 2-2h10c1.1045695 0 2 .8954305 2 2v10c0 1.1045695-.8954305 2-2 2h-10c-1.1045695 0-2-.8954305-2-2z"></path><path d="m12.5 12.5v-10c0-1.1045695-.8954305-2-2-2h2c1 0 2 .8954305 2 2v10c0 1.1045695-1 2-2 2h-2c1.1045695 0 2-.8954305 2-2z" fill="currentColor"></path><path d="m7.5 10.5 3-3-3-3" stroke="currentColor"></path><path d="m10.5 7.5h-8" stroke="currentColor"></path></g></svg>
			</button>
			<div class="brand">Fundo IMS</div>
		</div>

		<div class="center-search">
			<div class="search-box">
				<input type="search" placeholder="Search here" aria-label="Search" />
				<!-- search icon -->
				<svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#374151" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="#374151" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
			</div>
		</div>

		<div class="right">
			<a routerLink="/main-layout/notifications" aria-label="notifications">
			  <app-notification-icon></app-notification-icon>
			</a>

						<button class="icon-btn help-btn" aria-label="help">
								<!-- Help icon styled with app-icon so it inherits color: black -->
								<svg class="app-icon top-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" width="18" height="18" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
									<circle cx="12" cy="12" r="10" />
									<path d="M9.5 9.5a2.5 2.5 0 1 1 5 0c0 2-3 2.25-3 4" />
									<path d="M12 17h.01" />
								</svg>
						</button>

			<!-- mobile hamburger (animated into X) -->
			<button class="hamburger mobile-only" [class.open]="mobileMenuOpen" (click)="toggleMobileMenu()" aria-label="menu" title="Menu">
			  <span></span>
			  <span></span>
			  <span></span>
			</button>

			<div class="user-wrap">
				<button class="user-btn" (click)="toggleUserMenu()" aria-label="user menu">
					<img *ngIf="userPhotoUrl; else initials" [src]="userPhotoUrl" alt="user" class="user-img"/>
					<ng-template #initials>
						<div class="user-initials">
						  <!-- user silhouette icon uses app-icon so it matches centralized styles -->
						  <svg class="app-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
						    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
						    <circle cx="12" cy="8" r="4" />
						  </svg>
						</div>
					</ng-template>
				</button>

				<div class="user-menu" *ngIf="showUserMenu">
					<button class="user-menu-item" (click)="navigateTo('/settings')">Account settings</button>
					<hr />
					<button class="user-menu-item" (click)="signOut()">Sign out</button>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Account initialising modal (shown for new users who haven't completed setup) -->
<app-account-initialising *ngIf="showAccountInit || isCheckingInit" [isLoading]="isCheckingInit" (close)="onAccountInitClose()"></app-account-initialising>

<!-- mobile drawer and backdrop -->
<div class="mobile-drawer" [class.open]="mobileMenuOpen">
	<div class="mobile-drawer-header">
		<div class="mobile-user">
			<img *ngIf="userPhotoUrl; else initialsSmall" [src]="userPhotoUrl" alt="user" class="mobile-user-img" />
					<ng-template #initialsSmall>
						<div class="mobile-user-initials">
						  <svg class="app-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
						    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
						    <circle cx="12" cy="8" r="4" />
						  </svg>
						</div>
					</ng-template>
			<div class="mobile-user-name">{{ userDisplayName }}</div>
		</div>
	</div>
		<nav class="mobile-nav">
			<ul>
				<li><a routerLink="dashboard" (click)="closeMobileMenu()"><svg class="app-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><rect x="3" y="3" width="8" height="8" rx="1"/><rect x="13" y="3" width="8" height="8" rx="1"/></svg> Dashboard</a></li>
				<li><a routerLink="analytics" (click)="closeMobileMenu()"><svg class="app-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><rect x="5" y="10" width="3" height="11" rx="1"/><rect x="10.5" y="6" width="3" height="15" rx="1"/></svg> Reporting</a></li>
				<li><a routerLink="vehicle-register" (click)="closeMobileMenu()"><svg class="app-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M3 7l9-4 9 4v10a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V7z"/></svg> Register</a></li>
				<li><a routerLink="reminder" (click)="closeMobileMenu()"><svg class="app-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M12 8v5l3 3"/><circle cx="12" cy="12" r="9"/></svg> Reminder</a></li>
				<li><a routerLink="user-management" (click)="closeMobileMenu()"><svg class="app-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><circle cx="12" cy="8" r="3"/><path d="M5.5 20a6.5 6.5 0 0 1 13 0"/></svg> User Management</a></li>
				<li><a routerLink="policies" (click)="closeMobileMenu()"><svg class="app-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M7 2h8l4 4v14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h3"/></svg> Policies</a></li>
				<li><a routerLink="notifications" (click)="closeMobileMenu()"><svg class="app-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M15 17h5l-1.4-1.4A2 2 0 0 1 18 14.2V11a6 6 0 0 0-12 0v3.2c0 .5-.2 1.05-.6 1.4L4 17h5"/><path d="M13.7 21a2 2 0 0 1-3.4 0"/></svg> Notifications</a></li>
				<li><a routerLink="billing" (click)="closeMobileMenu()"><svg class="app-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M7 9h10"/></svg> Billing</a></li>
				<li><a routerLink="settings" (click)="closeMobileMenu()"><svg class="app-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><circle cx="12" cy="12" r="3"/></svg> Settings</a></li>
			</ul>
		</nav>
	<div class="mobile-drawer-footer">
		<button class="logout-btn" (click)="signOut(); closeMobileMenu()">Log out</button>
	</div>
</div>
<div class="drawer-backdrop" *ngIf="mobileMenuOpen" (click)="toggleMobileMenu()"></div>

<div class="app-shell">
	<aside class="side-nav" [class.collapsed]="sideNavCollapsed">
	<ul>
			<li>
				<a class="nav-link" routerLink="home" routerLinkActive="active" (click)="closeMobileMenu()">
					<span class="nav-icon">
						<!-- Home icon -->
						<svg class="app-icon nav-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
						  <path d="M3 11.5L12 4l9 7.5" />
						  <path d="M5 21V12h14v9" />
						</svg>
					</span>
					<span class="label">Home</span>
				</a>
			</li>
			<li>
				<a class="nav-link" routerLink="dashboard" routerLinkActive="active" (click)="closeMobileMenu()">
					<span class="nav-icon">
						<!-- Grid / Dashboard icon -->
						<svg class="app-icon nav-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
						  <rect x="3" y="3" width="8" height="8" rx="1" />
						  <rect x="13" y="3" width="8" height="8" rx="1" />
						  <rect x="3" y="13" width="8" height="8" rx="1" />
						  <rect x="13" y="13" width="8" height="8" rx="1" />
						</svg>
					</span>
					<span class="label">Dashboard</span>
				</a>
			</li>
			<li *ngIf="(userRole$ | async) === 'admin' || (userRole$ | async) === 'agent'">
				<a class="nav-link" routerLink="policies" routerLinkActive="active" (click)="closeMobileMenu()">
					<span class="nav-icon">
						<!-- Document / Policies icon -->
						<svg class="app-icon nav-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
						  <path d="M7 2h8l4 4v14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h3" />
						  <path d="M7 7h6" />
						</svg>
					</span>
					<span class="label">Policies</span>
				</a>
			</li>
			<li>
				<a class="nav-link" routerLink="analytics" routerLinkActive="active" (click)="closeMobileMenu()">
					<span class="nav-icon">
						<!-- Chart / Reporting icon -->
						<svg class="app-icon nav-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
						  <path d="M3 21h18" />
						  <rect x="5" y="10" width="3" height="11" rx="1" />
						  <rect x="10.5" y="6" width="3" height="15" rx="1" />
						  <rect x="16" y="2" width="3" height="19" rx="1" />
						</svg>
					</span>
					<span class="label">Reporting</span>
				</a>
			</li>
			<li>
				<a class="nav-link" routerLink="asset-registry" routerLinkActive="active" (click)="closeMobileMenu()">
					<span class="nav-icon">
						<!-- Box / Asset icon -->
						<svg class="app-icon nav-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
						  <path d="M3 7l9-4 9 4v10a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V7z" />
						  <path d="M12 3v14" />
						</svg>
					</span>
					<span class="label">Asset Registry</span>
				</a>
			</li>
			<li>
				<a class="nav-link" routerLink="user-management" routerLinkActive="active" (click)="closeMobileMenu()">
					<span class="nav-icon">
						<!-- User icon -->
						<svg class="app-icon nav-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
						  <circle cx="12" cy="8" r="3" />
						  <path d="M5.5 20a6.5 6.5 0 0 1 13 0" />
						</svg>
					</span>
					<span class="label">Users</span>
				</a>
			</li>
			<li>
				<a class="nav-link" routerLink="billing" routerLinkActive="active" (click)="closeMobileMenu()">
					<span class="nav-icon">
						<!-- Invoice / Billing icon -->
						<svg class="app-icon nav-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
						  <rect x="3" y="3" width="18" height="18" rx="2" />
						  <path d="M7 9h10" />
						  <path d="M7 13h6" />
						</svg>
					</span>
					<span class="label">Billing</span>
				</a>
			</li>
			<li>
				<a class="nav-link" routerLink="notifications" routerLinkActive="active" (click)="closeMobileMenu()">
					<span class="nav-icon">
						<!-- Bell / Notifications icon -->
						<svg class="app-icon nav-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
						  <path d="M15 17h5l-1.4-1.4A2 2 0 0 1 18 14.2V11a6 6 0 0 0-12 0v3.2c0 .5-.2 1.05-.6 1.4L4 17h5" />
						  <path d="M13.7 21a2 2 0 0 1-3.4 0" />
						</svg>
					</span>
					<span class="label">Notifications</span>
				</a>
			</li>
			<li>
				<a class="nav-link" routerLink="settings" routerLinkActive="active" (click)="closeMobileMenu()">
					<span class="nav-icon">
						<!-- Settings / Gear icon -->
						<svg class="app-icon nav-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
						  <circle cx="12" cy="12" r="3" />
						  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33" />
						</svg>
					</span>
					<span class="label">Settings</span>
				</a>
			</li>
	</ul>
  </aside>

	<main class="main-content">
		<div class="main-container">
			<div class="main-body">
				<!-- Main content outlet: child routes under `main-layout` will render here -->
				<router-outlet></router-outlet>
			</div>
		</div>
	</main>
</div>
