<!-- HEADER -->
<div class="header">
    <h1>Payment History</h1>
</div>

<!-- FILTERS -->
<div class="filters" [formGroup]="filterForm">
    <div class="filter-group">
        <label class="filter-label">Search</label>
        <input type="text" formControlName="search" placeholder="Invoice ID or Client" class="filter-select"
            style="min-width: 200px;">
    </div>
    <div class="filter-group">
        <label class="filter-label">From</label>
        <input type="date" formControlName="startDate" class="filter-select">
    </div>
    <div class="filter-group">
        <label class="filter-label">To</label>
        <input type="date" formControlName="endDate" class="filter-select">
    </div>
</div>

<!-- TABLE CARD -->
<div class="table-card">
    <table class="history-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Invoice ID</th>
                <th>Description</th>
                <th>Client</th>
                <th>Amount</th>
                <th>Status</th>
                <th class="text-right">Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngIf="isLoading">
                <td colspan="7">
                    <div class="loading-spinner-container">
                        <div class="loading-spinner"></div>
                    </div>
                </td>
            </tr>

            <tr *ngFor="let invoice of paginatedInvoices">
                <td>{{ invoice.createdAt?.toDate() | date:'mediumDate' }}</td>
                <td style="font-family: monospace; color: #666;">{{ invoice.id }}</td>
                <td>{{ invoice.description || 'Insurance Premium' }}</td>
                <td>{{ invoice.clientName }}</td>
                <td style="font-weight: 500;">{{ invoice.amount | currency }}</td>
                <td>
                    <span class="status" [ngClass]="{
                        'active': invoice.status === 'Paid',
                        'pending': invoice.status === 'Unpaid' || invoice.status === 'Pending'
                    }">
                        {{ invoice.status }}
                    </span>
                </td>
                <td class="actions">
                    <button class="btn-icon" (click)="downloadInvoice(invoice)" title="Download PDF">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20"
                            height="20">
                            <path fill-rule="evenodd"
                                d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </td>
            </tr>

            <tr *ngIf="!isLoading && paginatedInvoices.length === 0">
                <td colspan="7" style="text-align: center; padding: 24px; color: #86868b;">
                    No invoices found for the selected period.
                </td>
            </tr>
        </tbody>
    </table>

    <!-- PAGINATION -->
    <div class="pagination" *ngIf="totalPages > 1">
        <button class="btn-page" [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
            Previous
        </button>
        <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
        <button class="btn-page" [disabled]="currentPage === totalPages" (click)="changePage(currentPage + 1)">
            Next
        </button>
    </div>
</div>