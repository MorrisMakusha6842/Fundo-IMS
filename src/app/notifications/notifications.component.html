<div class="notifications-container">

    <!-- LEFT PANEL: USERS LIST -->
    <aside class="users-panel">
        <div class="panel-header">
            Conversations
        </div>

        <ul class="users-list">
            <li *ngIf="isLoadingUsers" class="user-item">
                <div class="loading-text">Loading users...</div>
            </li>

            <li *ngFor="let user of users" class="user-item" [class.active]="selectedUser?.uid === user.uid"
                (click)="selectUser(user)">
                <div class="user-avatar">
                    <img *ngIf="user.avatarDataUrl" [src]="user.avatarDataUrl" alt="{{user.displayName}}">
                    <span *ngIf="!user.avatarDataUrl" class="user-initials">{{getUserInitials(user)}}</span>
                </div>
                <div class="user-info">
                    <p class="user-name">{{user.displayName || user.email || 'Unknown User'}}</p>
                    <p class="last-message">{{user.role || 'Client'}}</p>
                </div>
            </li>

            <li *ngIf="!isLoadingUsers && users.length === 0" class="user-item">
                <div class="loading-text">No users found</div>
            </li>
        </ul>
    </aside>

    <!-- RIGHT PANEL: CHAT -->
    <section class="chat-panel" *ngIf="selectedUser">

        <!-- CHAT HEADER -->
        <header class="chat-header">
            <div class="header-user-avatar">
                <img *ngIf="selectedUser.avatarDataUrl" [src]="selectedUser.avatarDataUrl"
                    alt="{{selectedUser.displayName}}">
                <span *ngIf="!selectedUser.avatarDataUrl" class="user-initials">{{getUserInitials(selectedUser)}}</span>
            </div>
            <div class="header-user-info">
                <p class="header-user-name">{{selectedUser.displayName || selectedUser.email}}</p>
                <p class="header-user-status">{{selectedUser.role || 'User'}}</p>
            </div>
        </header>

        <!-- CHAT MESSAGES (Scrollable) -->
        <main class="messages-area">
            <div *ngIf="isLoadingMessages" class="loading-text">Loading messages...</div>

            <div *ngIf="!isLoadingMessages && messages.length === 0" class="no-messages">
                No messages yet. Start the conversation!
            </div>

            <div *ngFor="let message of messages" class="message-wrapper"
                [class.sent]="message.senderId !== selectedUser.uid"
                [class.received]="message.senderId === selectedUser.uid">
                <div class="message-bubble">
                    <p class="message-text">{{message.text}}</p>
                    <span class="message-time">{{message.timestamp | date:'short'}}</span>
                </div>
            </div>
        </main>

        <!-- MESSAGE INPUT (Sticky at bottom) -->
        <footer class="message-input-footer">
            <input type="text" [(ngModel)]="newMessage" (keyup.enter)="sendMessage()" placeholder="Type a message..."
                class="message-input" />
            <button class="send-button" (click)="sendMessage()" [disabled]="!newMessage.trim()">
                Send
            </button>
        </footer>

    </section>

    <!-- PLACEHOLDER WHEN NO USER SELECTED -->
    <section class="chat-panel placeholder" *ngIf="!selectedUser">
        <div class="placeholder-content">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1.5">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <p>Select a conversation to start messaging</p>
        </div>
    </section>
</div>