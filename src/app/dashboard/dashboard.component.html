<div class="dashboard">

  <!-- HEADER -->
  <div class="header">
    <ng-container *ngIf="isLoadingProfile; else loadedHeader">
      <div class="animate-pulse">
        <div class="h-8 bg-gray-200 rounded w-64 mb-2"></div>
        <div class="h-4 bg-gray-200 rounded w-48"></div>
      </div>
    </ng-container>
    <ng-template #loadedHeader>
      <div>
        <h1>Welcome, {{ displayName || 'User' }}</h1>
        <p>Insurance management system overview</p>
      </div>
    </ng-template>
  </div>

  <!-- KPIs -->
  <div class="kpi-grid">
    <div class="kpi-card">
      <div class="card-header-row">
        <div class="label">Total Users</div>
      </div>
      <h3>{{ kpiData.totalUsers | number }}</h3>
      <div class="trend up">Active Accounts</div>
    </div>

    <div class="kpi-card">
      <div class="card-header-row">
        <div class="label">Registered Vehicles</div>
      </div>
      <h3>{{ kpiData.registeredVehicles | number }}</h3>
      <div class="trend up">Fleet Size</div>
    </div>

    <div class="kpi-card">
      <div class="card-header-row">
        <div class="label">Expiring Policies</div>
      </div>
      <h3>{{ kpiData.expiringPolicies }}</h3>
      <div class="trend down">Needs Attention</div>
    </div>
  </div>

  <!-- ANALYTICS & TRENDS GRID -->
  <div class="kpi-grid" style="margin-top: 24px;">
    <!-- Chart Card 1 -->
    <div class="kpi-card">
      <div class="card-header-row">
        <div class="label">Active vs Expired</div>
      </div>
      <div class="chart-container">
        <svg class="chart" viewBox="0 0 200 200">
          <circle cx="100" cy="100" r="70" fill="#f5f5f7" />
          <path d="M100 100 L100 30 A70 70 0 1 1 30 100 Z" fill="#0071e3" />
        </svg>
      </div>
      <div class="trend">Policy Distribution</div>
    </div>

    <!-- Chart Card 2 -->
    <div class="kpi-card">
      <div class="card-header-row">
        <div class="label">Renewal Trends</div>
      </div>
      <div class="chart-container">
        <svg class="chart" viewBox="0 0 400 200">
          <polyline points="10,140 80,120 150,90 220,100 300,70" fill="none" stroke="#0071e3" stroke-width="3" />
          <polyline points="10,160 80,150 150,140 220,150 300,160" fill="none" stroke="#d2d2d7" stroke-width="2" />
        </svg>
      </div>
      <div class="trend up">Growth Rate</div>
    </div>

    <!-- Financial Stats -->
    <div class="kpi-card">
      <div class="combined-stats-card">
        <div class="stat-group">
          <div class="label">Revenue</div>
          <h3>{{ kpiData.revenue | currency:'USD':'symbol':'1.0-0' }}</h3>
          <div class="trend up">YTD</div>
        </div>
        <div class="stat-group">
          <div class="label">Pending Renewals</div>
          <h3>{{ kpiData.pendingRenewals }}</h3>
          <div class="trend down">Action Required</div>
        </div>
      </div>
    </div>
  </div>

  <!-- NEWLY REGISTERED VEHICLES TABLE -->
  <div class="table-card" style="margin-top: 24px;">
    <div class="table-card-header">
      <div class="table-title">
        <h3>Newly Registered Vehicles</h3>
      </div>
    </div>
    <div class="table-body expanded">
      <table class="policy-table">
        <thead>
          <tr>
            <th>Vehicle</th>
            <th>Client</th>
            <th>Status</th>
            <th>Submitted</th>
            <th class="text-right">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of newlyRegisteredVehicles">
            <td>{{ item.vehicle }} <span style="color: #86868b; font-size: 11px;">({{ item.id }})</span></td>
            <td>{{ item.client }}</td>
            <td>
              <span class="badge" [ngClass]="item.status.toLowerCase()">{{ item.status }}</span>
            </td>
            <td>{{ item.submitted }}</td>
            <td class="text-right">
              <button class="btn-secondary small">Review</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ACTIVITY LOG TABLE -->
  <div class="table-card" style="margin-top: 24px; margin-bottom: 40px;">
    <div class="table-card-header">
      <div class="table-title">
        <h3>Activity Log</h3>
      </div>
    </div>
    <div class="table-body expanded">
      <table class="policy-table">
        <thead>
          <tr>
            <th>Action</th>
            <th>Source</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let log of activityLog">
            <td>{{ log.action }}</td>
            <td><span class="badge active" style="background: #f5f5f7; color: #1d1d1f;">{{ log.source }}</span></td>
            <td style="color: #86868b;">{{ log.time }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>