<!-- HEADER -->
<div class="header">
    <h1>Purchased Policies</h1>
</div>

<!-- FILTERS -->
<div class="filters">
    <div class="filter-group">
        <label class="filter-label">Search</label>
        <input type="text" [formControl]="searchControl" placeholder="Policy, Asset or ID" class="filter-select" style="min-width: 200px;">
    </div>
    <form [formGroup]="dateRangeForm" class="filter-group">
        <label class="filter-label">Date Range</label>
        <input type="date" formControlName="start" class="filter-select">
        <span style="color: #86868b;">to</span>
        <input type="date" formControlName="end" class="filter-select">
    </form>
</div>

<!-- PURCHASES TABLE -->
<div class="table-card">
    <table class="reminders-table">
        <thead>
            <tr>
                <th>Policy / Asset</th>
                <th>Date</th>
                <th>Amount</th>
                <th>Type</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngIf="isLoading">
                <td colspan="5">
                    <div class="loading-spinner-container">
                        <div class="loading-spinner"></div>
                    </div>
                </td>
            </tr>
            <ng-container *ngIf="(purchases$ | async) as purchases">
                <tr *ngFor="let item of purchases">
                    <td>
                        <div>{{ item.assetName }}</div>
                        <div style="font-size: 11px; color: #86868b;">{{ item.description }}</div>
                    </td>
                    <td>{{ item.createdAt?.toDate() | date:'mediumDate' }}</td>
                    <td>{{ item.amount | currency }}</td>
                    <td>
                        <span class="badge" style="background: #f5f5f7; color: #666;">{{ (item.invoiceType || 'Proforma') | titlecase }}</span>
                    </td>
                    <td>
                        <span class="badge" [ngClass]="{
                            'completed': item.status === 'Paid',
                            'pending': item.status === 'Pending' || item.status === 'Unpaid'
                        }">
                            {{ item.status }}
                        </span>
                    </td>
                </tr>
                <tr *ngIf="!isLoading && purchases.length === 0">
                    <td colspan="5" style="text-align: center; padding: 24px; color: #86868b;">
                        No purchases found.
                    </td>
                </tr>
            </ng-container>
        </tbody>
    </table>
</div>